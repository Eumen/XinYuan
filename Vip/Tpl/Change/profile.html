<include file="Public:xyHead" />
<script src="__PUBLIC__/resource/avatar/jquery.min.js"></script>
<link href="__PUBLIC__/resource/avatar/bootstrap.min.css" rel="stylesheet">
<link href="__PUBLIC__/resource/avatar/cropper.min.css" rel="stylesheet">
<link href="__PUBLIC__/resource/avatar/sitelogo.css" rel="stylesheet">
<link href="__PUBLIC__/resource/ssi-uploader/styles/ssi-uploader.min.css" rel="stylesheet">
<script src="__PUBLIC__/resource/avatar/cropper.min.js"></script>
<script src="__PUBLIC__/resource/avatar/sitelogo.js"></script>
<script src="__PUBLIC__/resource/avatar/bootstrap.min.js"></script>
<script src="__PUBLIC__/resource/ssi-uploader/js/ssi-uploader.js"></script>
	<div id="wrap">
		<!-- Begin page content -->
		<div class="container">
			<div class="row">
				<div class="col-xs-12">
					<h4>
						<a href="__APP__/" class="glyphicon glyphicon-chevron-left bg-info" style="font-size: 16px;"></a>个人资料
					</h4>
				</div>
			</div>
			<div class="row">
				<div class="col-xs-12">
					<form class="form-horizontal" action="__URL__/changedataSave"
						id="form1" name="form1" method="post">
						<!-- #section:elements.form -->
						<input type="hidden" id="us_img" name="us_img" value="{$us_img}" />
						<div class="form-group">
							<label class="col-sm-3 col-xs-12 control-label no-padding-right">用户头像</label>
							<!--<div class="col-sm-2 col-xs-6">
								<div class="avatar-view" title="更换头像">
									<a href="__URL__/upload_add"> <img name="img_src"
										type="text" id="img_src" value="{$img_value}" src="{$img_src}"
										class="img-responsive thumbnail"></a>
								</div>
							</div>-->
							<div class="ibox-content">
								<div class="row">
									<div id="crop-avatar" class="col-md-6">
										<div class="avatar-view" title="点击更换头像">
									    	<img src="{$img_src}" id="img_src" name="img_src" value="{$img_value}" alt="Logo">
									    </div>
									</div>
								</div>
							</div>
						</div>
						<div class="form-group">
							<label class="col-sm-3 control-label no-padding-right">用户名</label>
							<div class="col-sm-9">
								<input name="user_id" type="text" id="user_id"
									value="{$vo['user_id']}" class="col-xs-12 col-sm-5"
									style="background-color: #ddd;" readonly="readonly" />
							</div>
						</div>
						<div class="form-group">
							<label class="col-sm-3 control-label no-padding-right">姓名</label>
							<div class="col-sm-9">
								<eq name="vo['user_name']" value=""> <input
									name="user_name" type="text" id="user_name"
									value="{$vo['user_name']}" class="col-xs-12 col-sm-5" /> <else />
								<input name="user_name" type="text" id="user_name"
									value="{$vo['user_name']}" class="col-xs-12 col-sm-5"
									readonly="readonly" /> </eq>
							</div>
						</div>
						<div class="form-group">
							<label class="col-sm-3 control-label no-padding-right">手机号</label>
							<div class="col-sm-9">
								<input name="tel" type="text" id="tel" value="{$vo['tel']}"
									class="col-xs-12 col-sm-5" readonly="readonly" />
							</div>
						</div>
						<div class="form-group">
							<label class="col-sm-3 control-label no-padding-right">身份证号</label>
							<div class="col-sm-9">
								<eq name="vo['user_code']" value=""> <input
									name="user_code" type="text" id="user_code"
									value="{$vo['user_code']}" class="col-xs-12 col-sm-5" /> <else />
								<input name="user_code" type="text" id="user_code"
									value="{$vo['user_code']}" class="col-xs-12 col-sm-5"
									readonly="readonly" /> </eq>
							</div>
						</div>
						<div class="form-group">
							<label class="col-sm-3 control-label no-padding-right">银行卡号</label>
							<div class="col-sm-9">
								<input name="bankcard_number" type="text" id="bankcard_number"
									value="{$vo['bankcard_number']}" class="col-xs-12 col-sm-5"
									maxlength="19" />
							</div>
						</div>
						<div class="form-group">
							<label class="col-sm-3 control-label no-padding-right">开户银行</label>
							<div class="col-sm-9">
								<select name="bank" id="bank" class="col-xs-12 col-sm-5">
									<volist name='bank' id='voo'> <eq name='bank[$key]'
										value="$b_bank['bank']">
									<option value="{$bank[$key]}" selected="selected"
										class="col-xs-offset-0">{$bank[$key]}</option>
									<else />
									<option value="{$bank[$key]}">{$bank[$key]}</option>
									</eq> </volist>
								</select>
							</div>
						</div>
						<div class="form-group">
							<label class="col-sm-3 control-label no-padding-right">省份</label>
							<div class="col-sm-9">
								<input name="bank_province" type="text" id="bank_province"
									value="{$vo['bank_province']}" class="col-xs-12 col-sm-5" />
							</div>
						</div>
						<div class="form-group">
							<label class="col-sm-3 control-label no-padding-right">城市</label>
							<div class="col-sm-9">
								<input name="bank_city" type="text" id="bank_city"
									value="{$vo['bank_city']}" class="col-xs-12 col-sm-5" />
							</div>
						</div>
						<div class="form-group">
							<label class="col-sm-3 control-label no-padding-right">开户详细地址</label>
							<div class="col-sm-9">
								<input name="bank_address" type="text" id="bank_address"
									value="{$vo['bank_address']}" class="col-xs-12 col-sm-5" />
							</div>
						</div>
						<div class="form-group">
							<label class="col-sm-3 control-label no-padding-right">密码</label>

							<div class="col-sm-9">
								<input name="password" type="password" id="password"
									value="{$vo['pwd1']}" class="col-xs-12 col-sm-5" />
							</div>
						</div>
						<div class="form-group">
							<label class="col-sm-3 control-label no-padding-right">确认密码</label>
							<div class="col-sm-9">
								<input name="confirm_password" type="password"
									id="confirm_password" value="{$vo['pwd1']}"
									class="col-xs-12 col-sm-5" />
							</div>
						</div>
						<div class="form-group">
							<label class="col-sm-3 control-label no-padding-right">二级密码</label>
							<div class="col-sm-9">
								<input name="password2" type="password" id="password2"
									value="{$vo['pwd2']}" class="col-xs-12 col-sm-5" />
							</div>
						</div>
						<div class="form-group">
							<label class="col-sm-3 control-label no-padding-right">确认二级密码</label>
							<div class="col-sm-9">
								<input name="confirm_password2" type="password"
									id="confirm_password2" value="{$vo['pwd2']}"
									class="col-xs-12 col-sm-5" />
							</div>
						</div>
						<div class="form-group">
							<label class="col-sm-3 control-label no-padding-right">手机验证码</label>
							<div class="col-sm-9">
								<input name="validCode" type="text"
									id="validCode" placeholder="请输入手机验证码"
									class="col-xs-10 col-sm-5" />
								<input id="validBtn" type="button" value="点击获取" style="width: 15%; height: 32px; background-color: #0e90d2; color: #fff; font-size: 14px" />
							</div>
						</div>
						&nbsp;<br>
						<div class="form-group">
							<div class="col-md-offset-3 col-md-9">
								<button class="btn btn-info" type="submit">
									<i class="ace-icon fa fa-check bigger-110"></i> 确认
								</button>

								&nbsp; &nbsp; &nbsp;
								<button class="btn" type="reset">
									<i class="ace-icon fa fa-undo bigger-110"></i> 重置
								</button>
							</div>
						</div>
					</form>
				</div>
			</div>
		</div>
	</div>
	</div>
	</div>
	<div class="modal fade" id="avatar-modal" aria-hidden="true" aria-labelledby="avatar-modal-label" role="dialog" tabindex="-1">
	<div class="modal-dialog modal-lg">
		<div class="modal-content">
			<form class="avatar-form" action="__APP__/Change/uploadImg" enctype="multipart/form-data" method="post">
				<div class="modal-header">
					<button class="close" data-dismiss="modal" type="button">&times;</button>
					<h4 class="modal-title" id="avatar-modal-label">更换头像</h4>
				</div>
				<div class="modal-body">
					<form id="myForm" action="__APP__/Change/uploadImg" method="post">
		                <input type="file" name="ssi-upload" multiple id="ssi-upload"/>
		            </form>
				</div>
  		</form>
  	</div>
  </div>
</div>

<script>

    $('#ssi-upload').ssi_uploader({ url: '__APP__/Change/uploadImg', maxNumberOfFiles: 1,
    	onUpload:function(data){
    		window.location.href = '__APP__/Change/profile'
    	},
   	 	responseValidation:{
   		    validationKey: {
   		      success: 'success',
   		      error: 'error'
   		    },
   		    resultKey: 'validationKey'
   		  }
    	});
//     $('#ssi-upload').ssi_uploader({inForm:true,
//     							   preview: true, 
//     							   maxNumberOfFiles: 1,
//     							   allowed: ['jpg', 'jpeg', 'png'],
//     							   maxFileSize: 1,
//     							   responseValidation:{
//     								    validationKey: 'type',
//     								    resultKey: 'msg',
//     								    success: 'success',
//     								    error: 'error'
//     								  }});
    
    $('#upBtn').click(function(){
    	$( "#myForm" ).submit();
    });
    

    $("#validBtn").click(function(){
   	 
   	 var partten = /^\d{11}$/;
   	 if($("#tel").val() == null ||$("#tel").val() == ""){
   		 alert("电话号不能为空");
   		 return false;
   	 }else if(!partten.test($("#tel").val())){
            alert('请输入正确的手机号码');
   		 return false;
   	 }else{
   		 $(this).attr("disabled","disabled");
   		 var time = 60;
   		 var timer = setInterval(function(){
   			 time--;
   			 $("#validBtn").val("剩余"+time+"秒");
   			 if(time == 0){
   				 clearInterval(timer);
   				 $("#validBtn").removeAttr("disabled");
   				 $("#validBtn").val("点击获取");
   			 }
   		 }, 1000);
   		 $.ajax({
   		      url: "__URL__/sendCode",
   		      type: "Post",
   		      data: "tel=" + $("#tel").val(),
   		      success: function(msg) {
   				  switch(msg)
   					{
   					case "1":
   					  alert("验证码已经发送")
   					  break;
   					case "-5":
   					  alert("短信余额不足")
   					  break;
   					default:
   					 alert(msg)
   					}
   				//alert(msg);//用来调试，返回1代表成功
   		      }
   		  })
   	 }
    });
</script>

<div class="loading" aria-label="Loading" role="img" tabindex="-1"></div>
	<include file="Public:xyFoot" />
</body>
